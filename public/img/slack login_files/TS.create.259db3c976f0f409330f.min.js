(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[29],{2428:function(e,t){(function(){TS.registerModule("create",{onStart:function e(){TS.create.model.populateFromLocalStorage();r=true;window.optimizely=window.optimizely||[];window.dataLayer=window.dataLayer||[];window.onpopstate=function(e){e.state&&D(e.state.step,true)};window.$CVO=window.$CVO||[];window.$CVO.push(["getCode",function(e){TS.create.model.convertroID(e)}]);P()}});var e;var t;var r;var a=3;var i=1500;var n;var o;var l;var s;var u;var c;var d;var m;var v;var f;var p=null;var g=null;var T=null;var S=false;var h="";var w=0;var b=[];var k=0;var y=true;var E=null==TS.interop.environment.desktop_app_version;var C=E&&(TS.boot_data.feature_native_app_start_non_mac||-1!==navigator.appVersion.indexOf("Mac"));var R=function e(t,r){try{window.sessionStorage.setItem(t,r)}catch(e){}};var A=function e(t){return window.sessionStorage.getItem("slack_"+t+"_signup_flow")};var I=function e(t){if(!history||!history.pushState||!history.replaceState)return;if(r){r=false;history.replaceState({step:t},"","#"+t);return}history.pushState({step:t},"","#"+t)};var D=function r(a,i,n){var o=Ze[a];if(!o){a=e[0];return r(a,n)}i||I(a);t=a;var l=et[a];var s=new Promise(function(e){if(!l)return e();if(!$("#signup_graphics").is(":visible"))return e();var t=new Image;t.onload=e;t.src=l});TS.interop.clog.track("GROWTH_CREATE_TEAM",{action:"enter_step",step:a});return Promise.all([o(n),s]).then(function(){if(a!==t)return;$("#signup_graphics").css("background-image","url("+l+")").removeClass("hide_image_loading");$("#signup_flow").attr("data-step",a)})};var L=function r(a){var i=e.indexOf(t);var n=e[i+1];if(n)return D(n,false,a);TS.error("no next step found")};var x=function t(){e=Xe};var P=function t(){var r=window.location.hash;je()&&TS.interop.clog.track("ANALYTICS_ERROR",{step:"start_flow",trigger:je()});M();var a=A("reset");R("slack_reenter_signup_flow",!a&&!TS.create.model.requireEmailConfirmation());x();var i=0;var n=function t(a){var i=e[a];return O(i).then(function(e){if(i===r||!e)return D(i);a+=1;return t(a)})};n(i)};var O=function e(t){var r;switch(t){case"email":r=TS.create.model.email()&&TS.utility.email.validateEmail(TS.create.model.email(),1).is_valid;if(!r)return Promise.resolve(false);if(!TS.create.model.leadID())return W().then(function(){return Promise.resolve(!!TS.create.model.leadID())});return Promise.resolve(true);case"confirmemail":r=TS.create.model.email()&&TS.utility.email.validateEmail(TS.create.model.email(),1).is_valid;if(!r)return Promise.resolve(false);if(!TS.create.model.leadID())return W().then(function(){if(TS.create.model.requireEmailConfirmation()&&!TS.create.model.emailConfirmationCode())return Promise.resolve(false);return Promise.resolve(!!TS.create.model.leadID()&&!!TS.create.model.email()&&!!TS.create.model.convertroID())});if(TS.create.model.requireEmailConfirmation()&&!TS.create.model.emailConfirmationCode())return Promise.resolve(false);return Promise.resolve(!!TS.create.model.email()&&!!TS.create.model.convertroID());case"teamname":n=TS.create.model.teamName()&&TS.validation.team_name(TS.create.model.teamName());return Promise.resolve(!!TS.create.model.teamName());case"googlesignin":return TS.google_auth.isAppsEmail(TS.create.model.email(),i).then(function(e){TS.create.model.googleAuthURL(e.auth_url);return Promise.resolve(!e.is_google)});case"url":if(!TS.create.model.url())return Promise.resolve(false);return ue(TS.create.model.url()).then(function(){return Promise.resolve(o)});case"name":if(!TS.create.model.username())return Promise.resolve(false);u=ye(TS.create.model.firstName())&&ye(TS.create.model.lastName());return pe(TS.create.model.username()).then(function(){return Promise.resolve(c&&u)});case"invites":return Promise.resolve(false);default:return Promise.resolve(false)}};var N=function r(){var a=_.findIndex(e,function(e){return e===t});if(-1==a)return TS.interop.i18n.t("Next","team_creation")();if(a==e.length-1)return TS.interop.i18n.t("Create Workspace","team_creation")();var i=e[a+1];switch(i){case"password":return TS.interop.i18n.t("Continue to Password","team_creation")();case"teamname":return TS.interop.i18n.t("Continue to Company Name","team_creation")();case"url":return TS.interop.i18n.t("Continue to Workspace URL","team_creation")();default:return TS.interop.i18n.t("Next","team_creation")()}};var M=function e(){var t;var r={};t=TS.templates.create_terms_of_service(r);$("body").append(t)};var U=function e(){var t;var r=TS.create.model.email()||TS.create.email_reminded;var a;var i={email:r,is_europe:TS.create.is_europe};if(!TS.create.model.hideReferralMessage()){a="49663050914"===TS.create.model.referralTeamID()||"2147483693"===TS.create.model.referralTeamID()||TS.create.model.hideReferralTeamName()?"Slack":TS.create.model.referralTeam().name;i.referral=a}t=TS.templates.create_email_view(i);$("#signup_flow").html(t);var n=document.getElementById("submit_btn");var o=document.getElementById("signup_email");var l=document.getElementById("email_form_body");var s=new TS.ui.EmailInput(o,n,l);o.focus();s.sig_submit.add(function(e,t,r){if(!r)return;TS.ui.startButtonSpinner(n);TS.signup.checkEmail(t,{get_info:true}).then(function(r){if(r.is_ok){e.destroy();_.get(r,"api_response.type")&&(p="google_apps"===r.api_response.type);return B(t)}if(r.error_key===TS.signup.ERROR_RATELIMITED)$("#ratelimit_alert").removeClass("hidden");else{$(".error_message").html(r.error_message);TS.utility.disableElement(n,true);TS.ui.stopButtonSpinner(n,false);$("#email_form_body").addClass("error")}})});return Promise.resolve()};var B=function e(t){G();TS.create.model.email(t);return W().then(function(){return L()})};var G=function e(){var t=$("#email_misc");var r;t.length&&TS.create.model.emailMisc(t.is(":checked"));if(TS.create.is_europe){var a=$("#email_misc_false");t.is(":checked")||a.is(":checked")?t.is(":checked")?r="email_sub_radio_button_selected":a&&(r="email_unsub_radio_button_selected"):r="no_radio_button_selected"}else r=t.is(":checked")?"email_sub_checkbox_checked":"email_sub_checkbox_unchecked";var i={event_id:"GROWTH_CREATE_TEAM",step:"team_creator_email_sub_pref",action:r,lead_id:TS.create.model.leadID()};TS.interop.api_unauthed.callSlackApiUnauthed("signup.clogEmailSubscription",i,function(e,t){e||TS.error(t)})};var W=function e(){var t=$("#email_form_body").find(".error_message");var r={email:TS.create.model.email(),referral_code:TS.create.model.referralCodeID(),referral_team:TS.create.model.referralTeamID(),locale:TS.interop.i18n.locale};TS.create.model.convertroID()&&(r.convertro_id=TS.create.model.convertroID());void 0!==TS.create.model.emailMisc()&&(r.email_misc=TS.create.model.emailMisc());return new Promise(function(e){TS.interop.api_unauthed.callSlackApiUnauthed("signup.addLead",r,function(a,i){if(a){TS.create.model.leadID(i.lead_id);TS.create.model.requireEmailConfirmation(i.require_email_confirmation);window.$CVO.push(["trackEvent",{type:"lead",id:TS.create.model.leadID(),amount:"1"}]);je()&&TS.interop.clog.track("ANALYTICS_ERROR",{step:"add_lead",trigger:je()});TS.create.model.referralCodeIDencoded()&&TS.interop.clog.track("GROWTH_REFERRAL",{action:"add_lead",trigger:"create_page",email:r.email,referral_code:TS.create.model.referralCodeIDencoded()});var n="other"===i.domain_type?"work/other":i.domain_type;TS.create.model.emailDomainType(n);window.dataLayer.push({event:"NewLead",leadid:TS.create.model.leadID(),domain_type:TS.create.model.emailDomainType()});TS.interop.experiments_unauthed.fetchVisitorAssignments().then(function(){var t="treatment"===TS.interop.experiments_unauthed.getGroup("include_optimizely_tag");t&&window.optimizely.push({type:"user",attributes:{lead_id:TS.create.model.leadID()}});e()});TS.interop.experiments_unauthed.fetchLeadAssignments(TS.create.model.leadID()).then(function(){e()});q()}else{var o=$("#submit_btn").get(0);o&&TS.ui.stopButtonSpinner(o,false);if("ratelimited"===i.error)$("#ratelimit_alert").removeClass("hidden");else if("failed_insertion"===i.error)$("#api_failed_alert").removeClass("hidden");else{t.html();$("#email_form_body").addClass("error")}e()}})})};var q=function e(){if(!TS.create.model.email())return;null===p&&TS.google_auth.isAppsEmail(TS.create.model.email()).then(function(e){e&&e.is_google&&(p=true)})};var H=function e(){var t=TS.templates.create_confirm_email_view({email:TS.create.model.email()});$("#signup_flow").html(t);var r=$(".confirmation_code");V(r);var a=TS.create.model.emailConfirmationCode();a&&F(a);r.find("input").first().focus();return Promise.resolve()};var V=function e(t){TS.ui.split_input.make(t);var r=$(".confirmation_code_checker");t.on("input","input",function(){r.attr("data-state","");if(!TS.ui.split_input.isComplete(t))return;r.attr("data-state","processing");var e=TS.ui.split_input.value(t);return F(e)})};var F=function e(t){var r=$(".confirmation_code");var a=$(".confirmation_code_checker");return TS.signup.verifyEmailConfirmationCode(TS.create.model.email(),t).then(function(e){if(e.is_valid){window.dataLayer.push({event:"confirmEmail"});var i=e&&e.api_response;if(i&&i.enterprise&&i.is_domain_claimed){TS.create.model.emailConfirmationCode(t);z(i);return}K(t)}else{TS.create.model.emailConfirmationCode("");TS.ui.split_input.clear(r);e.error_key===TS.signup.ERROR_RATELIMITED?a.attr("data-state","ratelimited"):a.attr("data-state","error")}return null})};var z=function e(t){var r;var a=t.email_has_account;var i=TS.create.model.email();var n="#";if(a){TS.info("Account found for the email address "+i);TS.boot_data&&TS.boot_data.other_accounts?_.each(TS.boot_data.other_accounts,function(e){if(r||!e.enterprise_id)return;if(e.enterprise_id==t.enterprise.id){TS.info("Found other_accounts.enterprise_id match for "+t.enterprise.id);if(e.email==i){TS.info("Found other_accounts.email match for "+e.email);TS.info("User is logged in as "+e.email+" on "+e.enterprise_id);r=true;n=e.team_url}}}):TS.info("boot_data.other_accounts is undefined. Presuming logged out.");r||TS.info("User is not logged into "+t.enterprise.id+" as "+i+" per other_accounts.")}var o=TS.templates.create_domain_claiming_view({email_domain:t.email_domain,email_has_account:a,email_is_org_admin:t.email_is_org_admin,is_logged_in:r,next_action_href:n,enterprise:t.enterprise});$("#signup_flow").html(o);var l={team:t.enterprise.id};function s(){TS.interop.api.call("auth.sso",l).then(function(e){var t=e.data;if(!t.ok){TS.error('auth.sso failed with "not OK"',t);u.html("SSO auth failed. :/");return}TS.info("auth.sso OK",e);var r=t.provider&&_.escape(t.provider.label||t.provider.name);var a=TS.interop.i18n.t("Sign in with {provider_name}","team_creation")({provider_name:r});c.html(a);u.prop("href",t.url);u.removeClass("disabled").prop("disabled",false)}).catch(function(e){TS.warn("auth.sso failed?",e);d+=1e3;if(d<3e3)TS.warn("retrying auth.sso in "+d+" ms");else{TS.error("auth.sso failed repeatedly - resetting");d=0}window.setTimeout(s,d)})}if(!r){var u=$("#next_action");var c=$("#custom_saml_button_label");u.addClass("disabled").prop("disabled",true);var d=0;TS.info("calling auth.sso to update login UI for team "+t.enterprise.id);return s()}};var K=function e(t){TS.create.model.emailConfirmationCode(t);if(TS.create.model.requireEmailConfirmation()){var r=TS.create.model.argsForCreateTeamAPI();var a=_.findKey(r,function(e){return void 0===e});if(a)return L();return $e().then(function(e){if(e.team_created)return;var t=e.error_key;if(t===TS.signup.ERROR_URL_TAKEN)return D("url");if(t===TS.signup.ERROR_INVALID_CODE){TS.create.model.emailConfirmationCode("");TS.ui.split_input.clear($(".confirmation_code"));$(".confirmation_code_checker").attr("data-state","error");return}t===TS.signup.ERROR_RATELIMITED&&$(".confirmation_code_checker").attr("data-state","ratelimited")})}return L()};var j=function e(){$("#signup_flow").html(TS.templates.create_password_view({continue_btn_copy:N()}));var t=$("#submit_btn");var r=$("#signup_password");window.load_zxcvbn_script&&load_zxcvbn_script();Q(t);r.focus();t.on("click",function(e){e.preventDefault();TS.ui.startButtonSpinner(this);var a=r.val();J().then(function(e){if(!e){TS.ui.stopButtonSpinner(t.get(0),false);TS.utility.disableElement(t,true);return}return Y(a)})});return Promise.resolve()};var Y=function e(t){TS.create.model.password(t);window.dataLayer.push({event:"CreatePassword"});return L()};var J=function e(t){t=t||$("#signup_password").val();var r=$("#password_form_body");var a={username:TS.create.model.username(),email:TS.create.model.email(),lead_id:TS.create.model.leadID()};return TS.utility.password.validate(t,a).then(function(e){if(!e.is_valid&&r&&r.length){var t=r.find(".error_message");r.addClass("error");t.text(e.error_message)}return Promise.resolve(e.is_valid)})};var Q=function e(t){var r=$("#password_form_body");var a=r.find("input");a.on("input",function(){var e=a.val();var i=TS.utility.password.hasValidSyntax(e);r.removeClass("error");TS.utility.disableElement(t,!i)})};var X=function e(){var t={team_name:TS.create.model.teamName(),continue_btn_copy:N()};var r=TS.templates.create_team_name_view(t);$("#signup_flow").html(r);var a=$("#submit_btn");var i=$("#signup_team_name");Z(i,a);i.focus();a.on("click",function(e){e.preventDefault();TS.ui.startButtonSpinner(this);var t=i.val().trim()||TS.create.model.teamName()||"";var r=TS.create.model.email()||"";var n=t.replace(/[^a-z0-9 -]/gi,"");n=n.replace(/^[ -]/gi,"").replace(/[ -]$/gi,"");var o={email:r,url:n};Ye("signup.suggestURL",o).then(function(e){if(e instanceof Error&&"denied"===e.message)return Promise.reject(e);if(!TS.validation.team_name(t))return Promise.reject(new Error("team_name_failed_validation"));TS.create.model.teamName(t);window.dataLayer.push({event:"CreateTeamName"});L({"signup.suggestURL":e})}).catch(function(e){if("denied"===e.message){Je();L()}TS.ui.stopButtonSpinner(a.get(0),false);return e});return false});return Promise.resolve()};var Z=function e(t,r){var a=$("#team_name_form_body");t.on("input",function(){var e=t.val().trim();n=TS.validation.team_name(e);var i=!n&&!!e;TS.utility.disableElement(r,!n);a.toggleClass("error",i)})};var ee=function e(t){if(t)return Promise.resolve(te(t));var r=TS.create.model.teamName()||"";var a=TS.create.model.email()||"";var i=r.replace(/[^a-z0-9 -]/gi,"");i=i.replace(/^[ -]/gi,"").replace(/[ -]$/gi,"");var n={email:a,url:i};return Ye("signup.suggestURL",n).then(function(e){e instanceof Error&&"ratelimited"===e.message&&_e();var t=te(e);return Promise.resolve(t)})};var te=function e(t){var r={unavailable_url:t.unavailable?t.unavailable[0]:null,available_url_suggestions:t.available?t.available.slice(0,4):[]};return Promise.resolve(r)};var re=function e(){g=TS.model.user.id+Date.now();return TS.google_auth.getAuthLink(g).then(function(e){var t={email_domain:TS.create.model.email().split("@")[1]};$("#signup_flow").html(TS.templates.create_google_auth_view(t));var r;var a=function e(){TS.interop.clog.track("GROWTH_CREATE_TEAM",{action:"google_account_connected",trigger:"google_auth_callback"});r.close();return D("google_invites")};$("#submit_btn").on("click",function(){var t=TS.utility.window.open({url:e,width:650,height:550,allowThirdPartyNavigation:true});r=TS.utility.window.get(t);TS.google_auth.pollForAuthStatus(g,a,r)});$("#skip_button").on("click",function(){D("invites")});return Promise.resolve()})};var ae=function t(){var r=$("#signup_wrapper");var a='<div class="signup_loading_wrapper">'+Handlebars.helpers.loadingHTML().string+"</div>";r.html(a);var i=TS.create.model.email().split("@")[1].split(".")[0];var n=TS.signup.checkURLAvailability(i,TS.create.model.email(),{get_suggestions:true});var o=TS.signup.suggestUsernameFromEmail(TS.create.model.email());Promise.all([n,o]).then(function(t){var r=t[0];var a=t[1];var n=[];if(r.error_key===TS.signup.ERROR_RATELIMITED||a.error_key===TS.signup.ERROR_RATELIMITED){$("#ratelimit_alert").removeClass("hidden");return}r.is_available?TS.create.model.url(i):r.available.length?TS.create.model.url(r.available[0]):n.push("url");a.has_suggestion?TS.create.model.username(a.username):n.push("name");if(n.length){e=n;L()}else $e().then(function(t){if(t.team_created)return;switch(t.error_key){case TS.signup.ERROR_BAD_EMAIL_DOMAIN:_invalidateEmail(t.error_message);break;case TS.signup.ERROR_URL_TAKEN:e=["url"];L();break;case TS.signup.ERROR_RATELIMITED:$("#ratelimit_alert").removeClass("hidden");break;default:var r=TS.interop.i18n.t("Oh no, something went wrong!","team_creation")();$("#api_failed_alert").html("<h3>"+r+"</h3>"+t.error_message).removeClass("hidden")}})})};var ie=function e(t){var r;t&&t["signup.suggestURL"]&&(r=t["signup.suggestURL"][0]);return ee(r).then(function(e){var t=e.available_url_suggestions||[];var r=TS.create.model.url()||t[0];ne(r,e);return Promise.resolve()})};var ne=function e(t,r){var a=TS.templates.create_url_view({url:t,continue_btn_copy:N()});$("#signup_flow").html(a);var i=$("#signup_url");var n=$("#submit_btn");var l=$("#url_form_body");le();se(i,n);if(t){i.focus().val(t);TS.create.model.url()||$("#available_url_message").removeClass("is_faded_out").attr("aria-hidden",false);$(".input_checkmark").removeClass("hidden")}else i.select();TS.create.model.url()||ve(r);n.on("click",function(e){e.preventDefault();TS.ui.startButtonSpinner(this);var t=i.val();var r=function e(r){r&&r.message&&"denied"===r.message&&L();if(o)return oe(t);l.addClass("error");TS.ui.stopButtonSpinner(n.get(0),false)};ue().then(r)})};var oe=function e(t){TS.create.model.url(t);window.dataLayer.push({event:"CreateURL"});if(TS.create.model.requireEmailConfirmation())return $e().then(function(e){if(e.team_created)return;TS.ui.stopButtonSpinner($("#submit_btn").get(0),false);var t=e.error_key;var r=e.error_message;if(t===TS.signup.ERROR_RATELIMITED)return _e();if(t===TS.signup.ERROR_URL_TAKEN){if(0===$("#signup_url").length){TS.create.model.invalidateURL();return ne(false,{})}ue().then(function(e){return Promise.resolve(e)}).catch(function(e){return e});return false}if(t===TS.signup.ERROR_INVALID_CODE)return D("confirmemail");var a=TS.interop.i18n.t("Oh no, something went wrong!","team_creation")();$("#api_failed_alert").html("<h3>"+a+"</h3>"+r).removeClass("hidden")});return L()};var le=function e(){var t=new Spinner({lines:9,length:3.5,width:2,radius:7,corners:1,rotate:0,direction:1,color:"#444",speed:1,trail:100,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"0px",left:"0px"});t.spin($(".input_spinner").get(0));me()};var se=function e(t,r){var a=$(".input_spinner");var i=$(".input_checkmark");t.on("input",function(){me();o=false;s=false;a.toggleClass("hidden",""===t.val());i.addClass("hidden");TS.utility.disableElement(r,true);clearTimeout(l);l=setTimeout(function(){if(s)return;ue()},1500)});t.on("input",function(){$("#unavailable_url_message, #available_url_message").addClass("is_faded_out").attr("aria-hidden",true)})};var ue=function e(t){var r=$(".input_spinner");var a=$(".input_checkmark");$("#unavailable_url_message").addClass("is_faded_out").attr("aria-hidden",true);s=true;t=t||$("#signup_url").val().trim();if(!ce(t)){r.addClass("hidden");return Promise.resolve()}return de(t).then(function(e){r.addClass("hidden");if(e instanceof Error&&"denied"===e.message){Je();a.addClass("hidden");return Promise.resolve(e)}a.toggleClass("hidden",!o);return Promise.resolve()})};var ce=function e(t){var r=$("#url_form_body");var a=r.find(".error_message");var i=$("#signup_url");t=t||i.val();if(!t||""===t){r.removeClass("error");i.one("input",function(){r.removeClass("error")});return}var n=TS.signup.checkURLSyntax(t);if(!n.is_valid){a.text(n.error_message);r.addClass("error");i.one("input",function(){e()});return false}r.removeClass("error");return true};var de=function e(r){r=r||$("#signup_url").val();var a={get_suggestions:"url"===t,lead_id:TS.create.model.leadID()};return TS.signup.checkURLAvailability(r,TS.create.model.email(),a).then(function(e){o=e.is_available;if(e.is_available){$("#unavailable_url_message").addClass("is_faded_out").attr("aria-hidden",true);TS.utility.disableElement($("#submit_btn"),false);return null}if(e.error_key&&"denied"===e.error_key)return new Error("denied");var t=$("#url_form_body");var r=t.find(".error_message");if(e.error_key===TS.signup.ERROR_RATELIMITED)_e();else if(a.get_suggestions&&e.available){r.empty();te(e).then(function(e){ve(e)})}else r.html(e.error_message);t.addClass("error");t.one("input",function(){t.removeClass("error")});return null})};var me=function e(){var t=$("#signup_url");var r=$("#url_overlay");var a=t.val();r.html(_.escape(a))};var _e=function e(){var t=$("#url_form_body");var r=t.find(".error_message");var a=$("#ratelimit_alert");if(a.length){r.html("");a.removeClass("hidden")}else r.html(TS.signup.getErrorMessage(TS.signup.ERROR_RATELIMITED));setTimeout(function(){a.addClass("hidden");t.removeClass("error")},6e5)};var ve=function e(t){if(t.unavailable_url){$("#available_url_message").addClass("is_faded_out").attr("aria-hidden",true);$("#unavailable_url").text(t.unavailable_url);var r=$("#url_suggestions");r.empty();if(t.available_url_suggestions.length>0){t.available_url_suggestions.forEach(function(e){var t=TS.templates.create_url_suggestion({url_suggestion:e});r.append(t)});fe();$("#unavailable_url_message").removeClass("is_faded_out").attr("aria-hidden",false)}else{var a=TS.interop.i18n.t("This web address is not available. Sorry!","team_creation")();$("#url_form_body").find(".error_message").html(a)}}else $("#unavailable_url_message").addClass("is_faded_out").attr("aria-hidden",true)};var fe=function e(){var t=$("#signup_url");$(".url_suggestion").on("click",function(){$("#url_form_body").removeClass("error");var e=$(this).attr("data-url-suggestion");t.val(e);ue().then(function(){TS.utility.disableElement($("#submit_btn"),false);t.focus().val(t.val())})})};var pe=function e(t){t=t||$("#signup_username").val().trim();if(!Se(t)){c=false;return Promise.resolve()}return he(t)};var ge=function e(t){var r=[];t.forEach(function(e){r.push(Te(e))});Promise.all(r).then(function(){m=$("#signup_real_name").val().trim();v=$("#signup_display_name").val().trim();return ke({real_name:m,display_name:v})}).catch(function(){var e=$("#submit_btn");TS.utility.disableElement(e,true);TS.ui.stopButtonSpinner(e.get(0),false)})};var Te=function e(t){return new Promise(function(e,r){TS.interop.api_unauthed.callSlackApiUnauthed("users.validateName",t,function(t,a,i){var n=i.field;if(t)e(a);else{a.error=TS.ui.validation.maybeConvertNameErrorCode(a.error);var o=TS.ui.validation.getErrorMessage(a.error,{maxlength:80});var l=$("#invite_form_body");"real_name"===n?TS.ui.validation.showWarning(l.find('input[name="'+n+'"]'),o,{custom_for:"real_name_profile_field_warnings",should_truncate:false}):"display_name"===n&&TS.ui.validation.showWarning(l.find('input[name="'+n+'"]'),o,{custom_for:"display_name_profile_field_warnings",should_truncate:false});r(new Error(a.error))}})})};var Se=function e(t){t=t||$("#signup_username").val();var r=$("#username_form_body");var a=r.find(".error_message");var i=TS.signup.checkUsernameSyntax(t);if(!i.is_valid){a.html(i.error_message);r.addClass("error")}return i.is_valid};var he=function e(t){t=t||$("#signup_username").val();return TS.signup.checkUsernameAvailability(t,{lead_id:TS.create.model.leadID()}).then(function(e){if(!e.is_valid){var t=$("#username_form_body");t.find(".error_message").html(e.error_message);t.addClass("error")}c=e.is_valid})};var we=function e(){return TS.signup.suggestUsernameFromEmail(TS.create.model.email(),{lead_id:TS.create.model.leadID()}).then(function(e){c=e.has_suggestion;var t;t={continue_btn_copy:N(),is_europe:TS.create.is_europe};if(TS.create.model.requireEmailConfirmation()){var r=void 0===TS.create.model.emailMisc();t.inc_misc_and_legalese=r;t.inc_misc_and_legalese=true}t.hide_display_name=true;var a=TS.templates.create_name_view(t);$("#signup_flow").html(a);var i=$("#submit_btn");var n=$("#signup_real_name");var o=$("#signup_display_name");be(n,i);i.on("click",function(e){e.preventDefault();TS.ui.startButtonSpinner(this);var t=[{field:"real_name",text:n.val().trim()},{field:"display_name",text:o.val().trim()}];return ge(t)})})};var be=function e(t,r){function a(){var e=$("#signup_real_name").val()||"";var t=!e.length||false;TS.utility.disableElement(r,t)}t.on("focusout",function(){a()});t.on("input",function(){clearTimeout(d);d=setTimeout(function(){a()},1500)})};var ke=function e(t){TS.create.model.realNametaggingName(t.real_name);TS.create.model.displayName(t.display_name);TS.create.model.username(t.username);G();window.dataLayer.push({event:"CreateUsername"});return L()};var ye=function e(t,r){var a=TS.signup.checkNameSyntax(t);var i=a.is_valid;if(r&&r.length){if(!i){var n=r.find(".error_message");n.html(a.error_message)}r.toggleClass("error",!i)}return i};var $e=function e(){TS.utility.disableElement($("#submit_btn"),true);return Ce().then(function(){return TS.signup.createTeam(TS.create.model.argsForCreateTeamAPI()).then(function(e){TS.utility.disableElement($("#submit_btn"),false);if(e.team_created){TS.create.model.signinURL(e.signin_url);window._vis_opt_queue=window._vis_opt_queue||[];window._vis_opt_queue.push(function(){_vis_opt_register_conversion(1,3)});if(je())TS.interop.clog.track("ANALYTICS_ERROR",{team_id:e.team_id,user_id:e.user_id,step:"team_created",trigger:je()});else{try{w=window.ga.getAll()[0].get("clientId")}catch(e){}TS.interop.clog.track("ANALYTICS_EVENT",{team_id:e.team_id,user_id:e.user_id,lead_id:TS.create.model.leadID(),ga_clientid:w,contexts:{ui_context:{action:"CREATE_TEAM",action_status:"SUCCESS"}},action:"send_ga_clientid",step:"team_created",trigger:"create_page"})}TS.create.model.referralCodeIDencoded()&&TS.interop.clog.track("GROWTH_REFERRAL",{action:"create_team",trigger:"create_page",referral_code:TS.create.model.referralCodeIDencoded()});window.dataLayer.push({event:"CreateTeam",teamid:e.team_id_raw,userid:e.user_id,domain_type:TS.create.model.emailDomainType()});window.$CVO.push(["trackEvent",{type:"create-a-team",id:e.user_id+"-"+e.team_id,amount:"1"}]);try{window.sessionStorage.clear()}catch(e){}TS.create.model.apiToken(e.api_token);TS.model.api_token=e.api_token;TS.model.user={id:e.user_id};e.valid_signup_domain&&TS.create.model.signupDomain(TS.create.model.email().split("@")[1]);D("invites")}return Promise.resolve(e)})})};var Ee=function e(){f.addClass("open");TS.interop.clog.track("GROWTH_CREATE_TEAM",{action:"enter_step",step:"show_tos"});setTimeout(function(){f.find(".tos_window").addClass("animate_in")},50);$(".tos_container").find("#create_tos_i_agree").focus();return new Promise(function(e){$(".tos_container").find("#create_tos_i_agree").on("click",function(){TS.create.model.tosAcknowledged(true);f.find(".tos_window").removeClass("animate_in");f.removeClass("open");window.dataLayer.push({event:"AcknowledgeCustomerTOS"});e()})})};var Ce=function e(){f=$(".tos_container");if(f.length&&!TS.create.model.tosAcknowledged())return Ee();return Promise.resolve(true)};var Re=function e(){S=true;return TS.google_auth.getContactList(g,{page:1,count:1e3}).then(function(e){if(!e.items||!e.items.length)return D("invites");var t=Ae(e.items);Ie(t);$("#signup_flow").html(TS.templates.create_invites_contact_list_view({placeholder:TS.interop.i18n.t("Search {num_contacts} contacts or add by email address","contact_list")({num_contacts:t.length}),signup_domain:TS.create.model.signupDomain()}));var r=function e(t){var r=TS.interop.i18n.t("Send {invitation_count, plural, =0 { Invitations} =1 {# Invitation} other {# Invitations}}","team_creation")({invitation_count:t.length});0===t.length?TS.utility.disableElement($("#submit_btn"),true):TS.utility.disableElement($("#submit_btn"),false);$('[data-label="invites_btn_label"]').text(r)};TS.ui.contact_list.build(t,{clog_event_name:"GROWTH_CREATE_TEAM"});TS.ui.contact_list.checkbox_change.add(r);$("#submit_btn").on("click",function(e){e.preventDefault();TS.ui.startButtonSpinner(this);window.dataLayer.push({event:"SendGoogleInvite"});var t=TS.ui.contact_list.getCheckedCheckboxes();TS.ui.contact_list.checkbox_change.remove(r);TS.ui.contact_list.destroy();if(!t.length)return Ne();var a=t.map(function(e){return{email:e.getAttribute("value"),type:"regular"}});Oe(a,"google_contacts")});$('[data-action="shared_invite_link_back"]').on("click",function(){D("shared_invite_link")});$("#secondary_btn").on("click",function(){window.dataLayer.push({event:"SkipGoogleInvite"});TS.ui.contact_list.checkbox_change.remove(r);TS.ui.contact_list.destroy();Ne()});return Promise.resolve()})};var Ae=function e(t){if(!t)return[];return _.chain(t).reject({email:TS.create.model.email()}).map(function(e){return{name:e.full_name,email:e.email}}).value()};var Ie=function e(t){var r=TS.create.model.email().split("@")[1];t.sort(function(e,t){if(!e.email&&!t.email)return 0;if(!e.email)return-1;if(!t.email)return 1;var a=e.email.split("@")[1];var i=t.email.split("@")[1];if(a===r&&i!==r)return-1;if(i===r&&a!==r)return 1;if(e.name&&t.name){if(e.name.toLowerCase()>t.name.toLowerCase())return 1;if(t.name.toLowerCase()>e.name.toLowerCase())return-1}else{if(e.email>t.email)return 1;if(t.email>e.email)return-1}return 0})};var De=function e(){var t=TS.templates.create_download_view({download_image:cdn_url+"/1f9bfa/img/get_started/ill_desktop-app@2x.jpg"});$("#signup_flow").html(t);var r=$("#submit_btn");var a=$("#continue_in_browser_link");r.on("click",function(e){e.preventDefault();TS.interop.clog.track("GROWTH_CREATE_TEAM",{action:"download_app"});window.dataLayer.push({event:"DownloadApp"});return D("install")});a.on("click",function(e){e.preventDefault();TS.interop.clog.track("GROWTH_CREATE_TEAM",{action:"continue_in_browser_without_download"});return Ue()})};var Le=function e(){var t=TS.templates.create_install_view({download_image:cdn_url+"/1f9bfa/img/get_started/ill_install-desktop-app@2x.jpg"});$("#signup_flow").html(t);var r=$("#retry_download_link");var a=$("#continue_in_browser_link");r.on("click",function(e){e.preventDefault();TS.interop.clog.track("GROWTH_CREATE_TEAM",{action:"retry_download"});return xe()});a.on("click",function(e){e.preventDefault();TS.interop.clog.track("GROWTH_CREATE_TEAM",{action:"continue_in_browser_without_download"});return Ue()});xe()};var xe=function e(){var t=$("#download_frame");var r=$("#autologin_frame");if(!t)return;var a=TS.create.download_src;t.attr("src",a);if(!r)return;a=r.attr("data-src");r.attr("src",a)};var Pe=function e(){var t=TS.templates.create_invites_view({signup_domain:TS.create.model.signupDomain(),whitelist_domain_checked:y});$("#signup_flow").html(t);var r=$("#invite_form_body");var i=r.find("#invite_rows");var n=$("#submit_btn");var o=b.length>=a?b.length+1:a;_.times(o,function(){Be(i)});var l=i.find("input");b.forEach(function(e,t){$(l.get(t)).val(e.email)});l.filter(function(){return""===this.value}).first().focus();We(i,n);r.find("#invite_rows").on("click",'[data-action="admin_invites_delete_row"]',function(){Ge(r,$(this).closest(".invite_row"))});r.find('[data-action="signup_add_invite"]').on("click",function(){Be(i)});Ke();$('[data-action="shared_invite_link_back"]').on("click",function(){b=He();D("shared_invite_link")});$("#secondary_btn").on("click",function(){window.dataLayer.push({event:"SkipInvite"});return Ne(r)});n.on("click",function(e){e.preventDefault();TS.ui.startButtonSpinner(this);window.dataLayer.push({event:"SendInvite"});var t=true;i.find(".invite_row").each(function(){var e=$(this).find('[name="email_address"]').val().trim();if(e&&!TS.utility.email_regex.test(e)){t=false;return false}});var r=He();if(t)return Oe(r,"manual");TS.ui.stopButtonSpinner(n.get(0),false)});i.on("keydown","input",function(e){if(e.keyCode===TS.utility.keymap.enter){var t=i.find("input");var r=t.index($(e.currentTarget));var a=r+1;if(a<t.length){e.preventDefault();t.get(a).focus()}}})};var Oe=function e(t,r){r=r||"manual";if(!t.length)return Ne();var a={token:TS.create.model.apiToken(),invites:JSON.stringify(t),source:"signup",mode:r};TS.interop.api_unauthed.callSlackApiUnauthed("users.admin.inviteBulk",a,function(e){if(e)return Ne();$("#invite_failed_alert").removeClass("hidden");setTimeout(Ne,5e3)})};var Ne=function e(){var t=$("#whitelist_domain");if(!t.length||!t.is(":checked"))return Me();var r=TS.create.model.email().split("@")[1];var a={prefs:JSON.stringify({signup_mode:"email",signup_domains:r}),mode:"create"};var i=function e(t){if(t)return Me();var a=TS.interop.i18n.t("<h3>Sorry, but something went wrong!</h3>People with an @{domain} email address won\u2019t be able to sign up without an invite yet. You\u2019ll be able to try setting this again later.","team_creation");a=a({domain:r});$("#invite_failed_alert").html(a).removeClass("hidden");setTimeout(Me(),500)};TS.interop.api.call("team.prefs.set",a).then(function(e){var t=e.data,r=e.args,a=e.request_id;var n=true;i(n,t,r,a);return{data:t,args:r,request_id:a}}).catch(function(e){var t=e.data,r=e.args,a=e.request_id;var n=false;i(n,t,r,a);return{data:t,args:r,request_id:a}})};var Me=function e(){if(C&&!TS.create.model.promo_campaign_code())return TS.interop.experiments_unauthed.fetchUserAssignments(TS.create.model.apiToken()).then(function(){"treatment"===TS.interop.experiments_unauthed.getGroup("native_app_start")?D("download"):Ue()});Ue()};var Ue=function e(){TS.interop.clog.track("GROWTH_CREATE_TEAM",{action:"launch_slack"});TS.create.promo_team_create_new||_.defer(function(){window.location=TS.create.model.signinURL()})};var Be=function e(t){var r=$(TS.templates.create_invite_row());t.append(r);r.find("input").focus()};var Ge=function e(t,r){if(!r||!r.length)return;r.slideToggle(100,function(){r.remove();0===$(".invite_row").length&&Be(t)})};var We=function e(t,r){t.find("input").each(function(){qe($(this),r)});t.on("focusout","input",function(){qe($(this),r)})};var qe=function e(t,r){var a=t.val().trim();var i=t.closest(".invite_row");if(!a)return;if(!TS.utility.email_regex.test(a)){var n=TS.interop.i18n.t("Oops! That looks like an invalid email address!","team_creation")();i.addClass("error").find(".error_message").text(n);TS.utility.disableElement(r,true);k+=1;t.one("input remove",function(){i.removeClass("error");k-=1;k||TS.utility.disableElement(r,false)});return}i.find(".input_checkmark").removeClass("hidden");$(this).one("input",function(){i.find(".input_checkmark").addClass("hidden")})};var He=function e(){var t=[];$("#invite_form_body").find("#invite_rows").find(".invite_row").each(function(){var e=$(this).find('[name="email_address"]').val().trim();e&&t.push({email:e,type:"regular"})});return t};var Ve=function e(){var t;var r=2e3;var a=43200;var i=TS.interop.datetime.toDayAmount(a);var n=TS.interop.i18n.t("{count, plural, =1 {# week} other {# weeks}}","team_creation","8ba3e1d705f5c68d68f2ff941821e633021afd59")({count:TS.interop.datetime.toWeekAmount(a)});C?TS.interop.experiments_unauthed.fetchUserAssignments(TS.create.model.apiToken()).then(function(){t="treatment"===TS.interop.experiments_unauthed.getGroup("native_app_start")?TS.interop.i18n.t("Continue","team_creation")():TS.interop.i18n.t("Launch Slack","team_creation")()}):t=TS.interop.i18n.t("Launch Slack","team_creation")();Fe(i,r).then(function(){var e=TS.templates.create_shared_invite_link_view({team_name:TS.create.model.teamName(),invite_url:T,link_duration:n,link_max_signups:r,coming_from_google_contacts:S,shared_invite_button_text:t});$("#signup_flow").html(e);ze()})};var Fe=function e(t,r){if(T)return Promise.resolve();return new Promise(function(e,a){var i={expiration:t,max_signups:r,token:TS.create.model.apiToken()};var n=function t(r,i){if(r){T=i.url;e()}else{TS.error("Could not create shared invite link:",i.error);a()}};TS.interop.api.call("users.admin.createSharedInvite",i).then(function(e){var t=e.data,r=e.args,a=e.request_id;var i=true;n(i,t,r,a);return{data:t,args:r,request_id:a}}).catch(function(e){var t=e.data,r=e.args,a=e.request_id;var i=false;n(i,t,r,a);return{data:t,args:r,request_id:a}})})};var ze=function e(){var t=$('input[name="shared_invite_link"]');var r=$(".shared_invite_link_tooltip");var a=$(".shared_invite_link_input_container");$('[data-action="copy_invite_link"]').on("click",function(){TS.clipboard.writeText(T);r.removeClass("hidden");a.hasClass("focus")||t.select();setTimeout(function(){r.addClass("hidden")},1e3)});t.focus(function(){t.select();a.addClass("focus")}).blur(function(){a.removeClass("focus")});$('[data-action="shared_invite_link_skip"]').on("click",function(){D("invites")});$('[data-action="shared_invite_link_skip_to_google"]').on("click",function(){D("google_invites")});$('[data-action="shared_invite_link_launch"]').on("click",function(){C?TS.interop.experiments_unauthed.fetchUserAssignments(TS.create.model.apiToken()).then(function(){"treatment"===TS.interop.experiments_unauthed.getGroup("native_app_start")?D("download"):Ue()}):Ue()});if(!TS.clipboard.canWriteText()){$('[data-action="copy_invite_link"]').addClass("hidden");t.addClass("small_right_padding")}t.focus()};var Ke=function e(){$("#whitelist_domain").on("change",function(){y=$(this).is(":checked")})};var je=function e(){h="";"dev"!==TS.boot_data.version_ts&&(window.google_tag_manager?window.gaData||(h="ga"):h="gtm");return h};var Ye=function e(t,r){return new Promise(function(e,a){TS.interop.api_unauthed.callSlackApiUnauthed(t,r,function(t,r){t&&e(r);return a(new Error(r.error))})}).then(function(e){return e}).catch(function(e){return e})};var Je=function r(){var a;"teamname"===t?a="TEAM_NAME":"url"===t&&(a="TEAM_URL");TS.interop.clog.track("GROWTH_CREATE_TEAM_DENIED",{contexts:{ui_context:{step:a,action:"impression"}}});var i=$("#submit_btn");var n=e.indexOf(t);e.splice(n+1,0,"error");TS.utility.disableElement(i,false);window.history.pushState(null,null,location.href);window.onpopstate=function(){history.go(1)}};var Qe=function e(){var t={body_template_html:TS.templates.generic_error({error_title:TS.interop.i18n.t("There was a problem creating your workspace.","team_creation")(),error_message:TS.interop.i18n.t("We were not able to create your new workspace","team_creation")()}),onShow:function e(){TS.create.model.reset();R("slack_reset_signup_flow",true)},disable_default_controls:true,show_cancel_button:false,disable_esc:true,onGo:function e(){$("body").fadeOut(100,function(){window.location="/create"})},modal_class:"fs_modal_error_step fs_modal_footer"};TS.ui.fs_modal.start(t);return Promise.resolve()};var Xe=["email","confirmemail","name","password","teamname","url"];var Ze={email:U,confirmemail:H,password:j,teamname:X,googlesignin:re,url:ie,name:we,invites:Pe,download:De,install:Le,shared_invite_link:Ve,google_invites:Re,error:Qe};var et={email:"/img/signup/step1-illi@2x.png",password:"/img/reset/password1@2x.png",teamname:"/img/signup/step2-illi@2x.png",googlesignin:"/img/signup/google-auth-illi@2x.png",url:"/img/signup/step3-illi@2x.png",name:"/img/signup/step4-illi@2x.png",invites:"/img/signup/step-invites@2x.png"}})()}},[[2428,0]]]);